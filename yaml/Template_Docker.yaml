steps:
  - checkout: self
    clean: True
  - task: Docker@2
    displayName: Construir la Imagen Docker
    inputs:
      containerRegistry: ${{ parameters.dockerRegistryEndpoint }}
      command: build
      Dockerfile: ${{ parameters.dockerfilepath }}
      buildContext: .
      arguments: |
        --tag $(ECR)/$(appname)-$(capacidad):$(Build.BuildNumber)

        --build-arg BUILD_CONFIGURATION=$(BUILD_CONFIGURATION)

        --build-arg AMBIENTE=$(ambiente)

        --build-arg MODE=development

        --secret id=nuget_pat,src=/home/debian/azure/azure_pat

      tags: $(Build.BuildNumber)
  - task: Docker@2
    displayName: Subir la Imagen
    inputs:
      containerRegistry: ${{ parameters.dockerRegistryEndpoint }}
      repository: $(appname)-$(capacidad)
      command: push
      tags: $(Build.BuildNumber)
